<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction • malan</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">malan</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/case-study-partial.html">Case study: Partial profiles</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Introduction</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction</h1>
                        <h4 class="author">Mikkel Meyer Andersen</h4>
            
            <h4 class="date">13 April, 2018</h4>
      
      
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<p>First, the library is loaded:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(malan)</code></pre></div>
<pre><code>## Loading required package: dplyr</code></pre>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<pre><code>## Loading required package: tidygraph</code></pre>
<pre><code>## 
## Attaching package: 'tidygraph'</code></pre>
<pre><code>## The following object is masked from 'package:stats':
## 
##     filter</code></pre>
<pre><code>## Loading required package: ggraph</code></pre>
<pre><code>## Loading required package: ggplot2</code></pre>
<p>For reproducibility, the seed for the (pseudo) random number generator is set:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)</code></pre></div>
<div id="population-simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#population-simulation" class="anchor"></a>Population simulation</h1>
<p>A standard Wright-Fisher population can be simulated (hiding progress information) as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sample_geneology.html">sample_geneology</a></span>(<span class="dt">population_size =</span> <span class="dv">10</span>, <span class="dt">generations =</span> <span class="dv">10</span>, <span class="dt">progress =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div id="building-the-pedigrees" class="section level2">
<h2 class="hasAnchor">
<a href="#building-the-pedigrees" class="anchor"></a>Building the pedigrees</h2>
<p>Until pedigrees are build/infered, there is not much information available (e.g. about children). So let us infer the pedigrees:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pedigrees &lt;-<span class="st"> </span><span class="kw"><a href="../reference/build_pedigrees.html">build_pedigrees</a></span>(sim_res$population, <span class="dt">progress =</span> <span class="ot">FALSE</span>)
pedigrees</code></pre></div>
<pre><code>## List of 2 pedigrees (of size 38, 10)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/pedigrees_count.html">pedigrees_count</a></span>(pedigrees)</code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/pedigrees_table.html">pedigrees_table</a></span>(pedigrees)</code></pre></div>
<pre><code>## 10 38 
##  1  1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/pedigree_size.html">pedigree_size</a></span>(pedigrees[[<span class="dv">1</span>]])</code></pre></div>
<pre><code>## [1] 38</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/pedigree_size.html">pedigree_size</a></span>(pedigrees[[<span class="dv">2</span>]])</code></pre></div>
<pre><code>## [1] 10</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#pedigree_size(pedigrees[[3]]) # error as there are only 2 pedigrees</span></code></pre></div>
<p>The pedigrees can be plotted all at once:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(pedigrees)</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>Or just one at a time:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(pedigrees[[<span class="dv">1</span>]])</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(pedigrees[[<span class="dv">2</span>]])</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>Some information about the population can be obtained. For example, the individuals in the final generation can be saved:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(sim_res, <span class="dv">1</span>)</code></pre></div>
<pre><code>## List of 7
##  $ population                :Classes 'malan_population', 'externalptr' &lt;externalptr&gt; 
##  $ generations               : num 10
##  $ founders                  : int 2
##  $ growth_type               : chr "ConstantPopulationSize"
##  $ sdo_type                  : chr "StandardWF"
##  $ end_generation_individuals:List of 10
##  $ individuals_generations   :List of 23</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">live_individuals &lt;-<span class="st"> </span>sim_res$end_generation_individuals</code></pre></div>
<p>And a live individual is printed:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/print_individual.html">print_individual</a></span>(live_individuals[[<span class="dv">1</span>]])</code></pre></div>
<pre><code>##   pid = 1 with father pid = 11 and no children</code></pre>
<p>We can also print another individual (from the entire population):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">indv &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_individual.html">get_individual</a></span>(sim_res$population, <span class="dv">22</span>)
<span class="kw"><a href="../reference/print_individual.html">print_individual</a></span>(indv)</code></pre></div>
<pre><code>##   pid = 22 with father pid = 28 and children (n = 2): 
##     pid = 16 with father pid = 28 and 2 children
##     pid = 14 with father pid = 28 and 2 children</code></pre>
</div>
<div id="run-a-mutation-process" class="section level2">
<h2 class="hasAnchor">
<a href="#run-a-mutation-process" class="anchor"></a>Run a mutation process</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)

mutrts &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>)
<span class="kw"><a href="../reference/pedigrees_all_populate_haplotypes.html">pedigrees_all_populate_haplotypes</a></span>(<span class="dt">pedigrees =</span> pedigrees, 
                                  <span class="dt">loci =</span> <span class="kw">length</span>(mutrts), 
                                  <span class="dt">mutation_rates =</span> mutrts, <span class="dt">progress =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>Individual pedigrees can now be plotted with haplotype information:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(pedigrees[[<span class="dv">1</span>]], <span class="dt">haplotypes =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<p>And the individual id can be removed to only display the haplotype:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(pedigrees[[<span class="dv">1</span>]], <span class="dt">ids =</span> <span class="ot">FALSE</span>, <span class="dt">haplotypes =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<p>And one or more individuals can be marked/highlighted:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(pedigrees[[<span class="dv">1</span>]], <span class="dt">ids =</span> <span class="ot">TRUE</span>, <span class="dt">haplotypes =</span> <span class="ot">TRUE</span>, <span class="dt">mark_pids =</span> <span class="kw">c</span>(<span class="dv">14</span>, <span class="dv">16</span>))</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
</div>
<div id="more-than-1-full-generation" class="section level2">
<h2 class="hasAnchor">
<a href="#more-than-1-full-generation" class="anchor"></a>More than 1 full generation</h2>
<p>By standard, only the last generation contains <span class="math inline">\(N\)</span> individuals. If the last 3 generations should be full, this can be done by specifying <code>extra_generations_full = 2</code> as follows (2 extra as the last generation always has <span class="math inline">\(N\)</span> individuals):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
sim_res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sample_geneology.html">sample_geneology</a></span>(<span class="dt">population_size =</span> <span class="dv">10</span>, 
                            <span class="dt">generations =</span> <span class="dv">5</span>, 
                            <span class="dt">extra_generations_full =</span> <span class="dv">2</span>,
                            <span class="dt">progress =</span> <span class="ot">FALSE</span>)
pedigrees &lt;-<span class="st"> </span><span class="kw"><a href="../reference/build_pedigrees.html">build_pedigrees</a></span>(sim_res$population, <span class="dt">progress =</span> <span class="ot">FALSE</span>)
<span class="kw">plot</span>(pedigrees)</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
<p>And to obtain the complete history, <code>extra_generations_full</code> is set to <code>generations</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
sim_res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sample_geneology.html">sample_geneology</a></span>(<span class="dt">population_size =</span> <span class="dv">10</span>, 
                            <span class="dt">generations =</span> <span class="dv">5</span>, 
                            <span class="dt">extra_generations_full =</span> <span class="dv">10</span>,
                            <span class="dt">progress =</span> <span class="ot">FALSE</span>)
pedigrees &lt;-<span class="st"> </span><span class="kw"><a href="../reference/build_pedigrees.html">build_pedigrees</a></span>(sim_res$population, <span class="dt">progress =</span> <span class="ot">FALSE</span>)
<span class="kw">plot</span>(pedigrees)</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
<p>Now, there are 10 individuals in all generations.</p>
</div>
<div id="simulate-to-one-founder" class="section level2">
<h2 class="hasAnchor">
<a href="#simulate-to-one-founder" class="anchor"></a>Simulate to one founder</h2>
<p>By standard, the number of generations are specified. Instead, it can be specified to continue simulating until one common founder is reached by specifying <code>generations = -1</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
sim_res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sample_geneology.html">sample_geneology</a></span>(<span class="dt">population_size =</span> <span class="dv">10</span>, 
                            <span class="dt">generations =</span> -<span class="dv">1</span>, 
                            <span class="dt">progress =</span> <span class="ot">FALSE</span>)
pedigrees &lt;-<span class="st"> </span><span class="kw"><a href="../reference/build_pedigrees.html">build_pedigrees</a></span>(sim_res$population, <span class="dt">progress =</span> <span class="ot">FALSE</span>)
<span class="kw">plot</span>(pedigrees)</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<p>The number of generations needed can be obtained as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_res$generations</code></pre></div>
<pre><code>## [1] 15</code></pre>
</div>
</div>
<div id="counting-matches" class="section level1">
<h1 class="hasAnchor">
<a href="#counting-matches" class="anchor"></a>Counting matches</h1>
<div id="simulating-the-population" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-the-population" class="anchor"></a>Simulating the population</h2>
<p>Let’s try to simulate a larger population with 3 full generations (the additional <code>individuals_generations_return</code> is to get all individuals in the last 3 generations returned in the <code>individuals_generations</code> slot, cf. below, and the default value is 2 but is included here for demonstration purposes):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
sim_res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sample_geneology.html">sample_geneology</a></span>(<span class="dt">population_size =</span> <span class="fl">1e3</span>, 
                            <span class="dt">generations =</span> <span class="dv">200</span>, 
                            <span class="dt">extra_generations_full =</span> <span class="dv">2</span>,
                            <span class="dt">individuals_generations_return =</span> <span class="dv">2</span>, <span class="co"># default value</span>
                            <span class="dt">progress =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>And build the pedigrees:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pedigrees &lt;-<span class="st"> </span><span class="kw"><a href="../reference/build_pedigrees.html">build_pedigrees</a></span>(sim_res$population, <span class="dt">progress =</span> <span class="ot">FALSE</span>)
<span class="kw"><a href="../reference/pedigrees_table.html">pedigrees_table</a></span>(pedigrees)</code></pre></div>
<pre><code>##  311  736  758 2740  407 2464 2565 1421 
##    1    1    1    1    1    1    1    1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/pedigrees_count.html">pedigrees_count</a></span>(pedigrees)</code></pre></div>
<pre><code>## [1] 8</code></pre>
<p>So there are 8 pedigrees. Let’s try to plot the largest one:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ped_sizes &lt;-<span class="st"> </span><span class="kw">sapply</span>(1L:<span class="kw"><a href="../reference/pedigrees_count.html">pedigrees_count</a></span>(pedigrees), function(i) <span class="kw"><a href="../reference/pedigree_size.html">pedigree_size</a></span>(pedigrees[[i]]))
ped_sizes</code></pre></div>
<pre><code>## [1] 2740 2565 2464 1421  758  736  407  311</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">largest_i &lt;-<span class="st"> </span><span class="kw">which.max</span>(ped_sizes)
<span class="kw">plot</span>(pedigrees[[largest_i]])</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
<p>And the impose mutations from a 20 locus haplotype with mutation rate 0.001 per locus:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">10</span>)
mutrts &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="fl">0.001</span>, <span class="dv">20</span>)
<span class="kw"><a href="../reference/pedigrees_all_populate_haplotypes.html">pedigrees_all_populate_haplotypes</a></span>(<span class="dt">pedigrees =</span> pedigrees, 
                                  <span class="dt">loci =</span> <span class="kw">length</span>(mutrts), 
                                  <span class="dt">mutation_rates =</span> mutrts, <span class="dt">progress =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>The haplotypes at the live individuals (3 generations) can be inspected:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">live_individuals &lt;-<span class="st"> </span>sim_res$individuals_generations
<span class="kw">length</span>(live_individuals)</code></pre></div>
<pre><code>## [1] 3000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">haps &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_haplotypes_individuals.html">get_haplotypes_individuals</a></span>(<span class="dt">individuals =</span> live_individuals)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(haps)</code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
## [1,]    0    0    0    1    0    0   -1   -1   -1     0     0     1     0
## [2,]    0    1    0    0    0    0    0    0    0     1     0     0     0
## [3,]    1    1    0    0    0    0   -1    0    0     1     0     0     0
## [4,]    0   -1    0    0    0    0    0    0    0     0     0     0     0
## [5,]    0    0    0    0    0    0    0   -1   -1     0     0     0     0
## [6,]    0   -1    0    1    0    0    0    0    0     0     0     0     0
##      [,14] [,15] [,16] [,17] [,18] [,19] [,20]
## [1,]     0     0     0     0    -1     0     0
## [2,]     0    -1     0    -2     0     0    -1
## [3,]     0    -1     0    -1     0     0     0
## [4,]     0     0     1     0     0     1     0
## [5,]     0     1     0     0     0     0     0
## [6,]     0     0     0     0     0     0     0</code></pre>
<p>Lets look at the spectrum:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">haps_str &lt;-<span class="st"> </span><span class="kw">apply</span>(haps, <span class="dv">1</span>, paste0, <span class="dt">collapse =</span> <span class="st">";"</span>)
haps_tab &lt;-<span class="st"> </span><span class="kw">table</span>(haps_str)
<span class="kw">sort</span>(haps_tab, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span>:<span class="dv">10</span>]</code></pre></div>
<pre><code>## haps_str
##    0;0;0;1;0;0;0;0;0;0;0;0;0;-1;-1;0;0;0;0;0 
##                                          140 
##     0;-1;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0 
##                                          123 
##      0;0;0;0;0;0;0;0;0;0;0;0;1;0;0;0;0;0;0;0 
##                                          120 
##  0;0;0;0;0;0;-1;-1;-1;0;0;1;0;0;0;0;0;-1;0;0 
##                                          111 
##     0;-1;0;0;0;0;0;0;0;0;0;0;0;0;0;1;0;0;1;0 
##                                           96 
##     -1;0;0;0;0;0;0;0;1;0;0;1;0;0;0;0;0;0;0;0 
##                                           96 
##      0;0;1;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;1 
##                                           92 
##   0;1;0;0;0;0;0;0;0;1;0;0;0;0;-1;0;-2;0;0;-1 
##                                           87 
##   1;1;0;0;0;0;-1;0;0;1;0;0;0;0;-1;0;-1;0;0;0 
##                                           80 
## 0;0;0;0;0;0;-1;-1;-1;0;0;1;0;-1;0;0;0;-1;0;0 
##                                           79</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">spectrum &lt;-<span class="st"> </span><span class="kw">table</span>(haps_tab)
spectrum</code></pre></div>
<pre><code>## haps_tab
##   1   2   3   4   5   6   7   8   9  10  12  14  15  16  17  18  19  20 
##  51  16  11  10   5  10   4   2   2   3   2   2   4   1   1   1   2   1 
##  21  22  23  24  25  26  27  28  30  33  37  38  43  49  51  52  56  58 
##   3   1   1   2   2   2   2   1   2   1   2   1   1   3   1   2   1   2 
##  68  70  75  79  80  87  92  96 111 120 123 140 
##   2   1   1   2   1   1   1   2   1   1   1   1</code></pre>
</div>
<div id="drawing-an-individual-and-counting-matches" class="section level2">
<h2 class="hasAnchor">
<a href="#drawing-an-individual-and-counting-matches" class="anchor"></a>Drawing an individual and counting matches</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">100</span>)
Q_index &lt;-<span class="st"> </span><span class="kw">sample.int</span>(<span class="dt">n =</span> <span class="kw">length</span>(live_individuals), <span class="dt">size =</span> <span class="dv">1</span>)
Q &lt;-<span class="st"> </span>live_individuals[[Q_index]]
Q_hap &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_haplotype.html">get_haplotype</a></span>(Q)
Q_hap</code></pre></div>
<pre><code>##  [1]  1  1  0  0  0  0 -1  0  0  1  0  0  0  0 -1  0 -1  0  0  0</code></pre>
<p>First, identify <span class="math inline">\(Q\)</span>’s pedigree:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Q_ped &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_pedigree_from_individual.html">get_pedigree_from_individual</a></span>(Q)</code></pre></div>
<p>Now, count matches in pedigree and in live population:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/count_haplotype_occurrences_pedigree.html">count_haplotype_occurrences_pedigree</a></span>(<span class="dt">pedigree =</span> Q_ped, <span class="dt">haplotype =</span> Q_hap, <span class="dt">generation_upper_bound_in_result =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>## [1] 80</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/count_haplotype_occurrences_individuals.html">count_haplotype_occurrences_individuals</a></span>(<span class="dt">individuals =</span> live_individuals, <span class="dt">haplotype =</span> Q_hap)</code></pre></div>
<pre><code>## [1] 80</code></pre>
<p>We can also inspect pedigree matches information about number of meioses and <span class="math inline">\(L_1\)</span> distances:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">path_details &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pedigree_haplotype_matches_in_pedigree_meiosis_L1_dists.html">pedigree_haplotype_matches_in_pedigree_meiosis_L1_dists</a></span>(<span class="dt">suspect =</span> Q, 
                                                                        <span class="dt">generation_upper_bound_in_result =</span> <span class="dv">2</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">nrow</span>(path_details)</code></pre></div>
<pre><code>## [1] 80</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(path_details)</code></pre></div>
<pre><code>##      meioses max_L1  pid
## [1,]      28      0 2132
## [2,]      29      0 1692
## [3,]      29      0 1309
## [4,]      30      0  379
## [5,]      30      0  765
## [6,]      30      0  791</code></pre>
<p>Look at the distribution of number of meioses between <span class="math inline">\(Q\)</span> and the matches (there are 0 meioses between Q and himself):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">meioses &lt;-<span class="st"> </span>path_details[, <span class="dv">1</span>]
<span class="kw">hist</span>(meioses)</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-33-1.png" width="672"></p>
<p>On the path between <span class="math inline">\(Q\)</span> and the match, the maximum <span class="math inline">\(L_1\)</span> difference between <span class="math inline">\(Q\)</span>’s haplotype and the haplotypes of the individuals on the path is recorded (0 means that that no mutations have occured on the path between <span class="math inline">\(Q\)</span> and the match):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">L1_max &lt;-<span class="st"> </span>path_details[, <span class="dv">2</span>]
<span class="kw">table</span>(L1_max)</code></pre></div>
<pre><code>## L1_max
##  0 
## 80</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(L1_max ==<span class="st"> </span><span class="dv">0</span>)</code></pre></div>
<pre><code>## [1] 1</code></pre>
</div>
<div id="mixtures" class="section level2">
<h2 class="hasAnchor">
<a href="#mixtures" class="anchor"></a>Mixtures</h2>
<p>Draw true contributors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">100</span>)
U_indices &lt;-<span class="st"> </span><span class="kw">sample.int</span>(<span class="dt">n =</span> <span class="kw">length</span>(live_individuals), <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">replace =</span> <span class="ot">FALSE</span>)
U1 &lt;-<span class="st"> </span>live_individuals[[U_indices[<span class="dv">1</span>]]]
U2 &lt;-<span class="st"> </span>live_individuals[[U_indices[<span class="dv">2</span>]]]
H1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_haplotype.html">get_haplotype</a></span>(U1)
H2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_haplotype.html">get_haplotype</a></span>(U2)</code></pre></div>
<p>View haplotypes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rbind</span>(H1, H2)</code></pre></div>
<pre><code>##    [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
## H1    1    1    0    0    0    0   -1    0    0     1     0     0     0
## H2    0    1   -1    1    0    0    0    1    1     1     0     0     0
##    [,14] [,15] [,16] [,17] [,18] [,19] [,20]
## H1     0    -1     0    -1     0     0     0
## H2     0    -1     0    -1     0     0     0</code></pre>
<p>Now, find those haplotype in live individuals (those haplotypes are in <code>haps</code> from before) that are included in (or compatible with) the mixture:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#mixres &lt;- indices_in_mixture_by_haplotype_matrix(haplotypes = haps, H1 = H1, H2 = H2)</span>
mixres &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mixture_info_by_individuals.html">mixture_info_by_individuals</a></span>(live_individuals, U1, U2)
<span class="kw">str</span>(mixres, <span class="dv">1</span>)</code></pre></div>
<pre><code>## List of 13
##  $ pids_included_in_mixture     : int [1:183] 3 41 48 51 59 72 85 149 164 192 ...
##  $ pids_included_in_mixture_info:List of 183
##  $ pids_matching_donor1         : int [1:80] 3 85 164 192 242 302 314 379 384 457 ...
##  $ pids_matching_donor2         : int [1:2] 773 1541
##  $ pids_others_included         : int [1:101] 41 48 51 59 72 149 279 285 294 305 ...
##  $ pids_donor12_meiotic_dist    : int 166
##  $ donor1_family_info           :List of 5
##  $ donor2_family_info           :List of 5
##  $ donor1_profile               : int [1:20] 1 1 0 0 0 0 -1 0 0 1 ...
##  $ donor2_profile               : int [1:20] 0 1 -1 1 0 0 0 1 1 1 ...
##  $ donor1_pid                   : int 924
##  $ donor2_pid                   : int 773
##  $ loci_not_matching            : num 6</code></pre>
<p>Compare with matches:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(mixres$pids_matching_donor1)</code></pre></div>
<pre><code>## [1] 80</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/count_haplotype_occurrences_individuals.html">count_haplotype_occurrences_individuals</a></span>(<span class="dt">individuals =</span> live_individuals, <span class="dt">haplotype =</span> H1)</code></pre></div>
<pre><code>## [1] 80</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(mixres$pids_matching_donor2)</code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/count_haplotype_occurrences_individuals.html">count_haplotype_occurrences_individuals</a></span>(<span class="dt">individuals =</span> live_individuals, <span class="dt">haplotype =</span> H2)</code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>In mixture that are not H1 and not H2:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(mixres$pids_others_included)</code></pre></div>
<pre><code>## [1] 101</code></pre>
<p>Inspect these (only unique ones):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">others_haps &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_haplotypes_pids.html">get_haplotypes_pids</a></span>(sim_res$population, mixres$pids_others_included)
others_haps &lt;-<span class="st"> </span>others_haps[!<span class="kw">duplicated</span>(others_haps), ]
others_haps</code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
## [1,]    0    1   -1    0    0    0    0    1    1     1     0     0     0
## [2,]    0    1    0    0    0    0   -1    0    0     1     0     0     0
## [3,]    0    1    0    0    0    0    0    0    0     1     0     0     0
## [4,]    0    1   -1    0    0    0   -1    1    1     1     0     0     0
##      [,14] [,15] [,16] [,17] [,18] [,19] [,20]
## [1,]     0    -1     0    -1     0     0     0
## [2,]     0    -1     0    -1     0     0     0
## [3,]     0    -1     0    -1     0     0     0
## [4,]     0    -1     0    -1     0     0     0</code></pre>
<p>And get their population counts:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">others_haps_counts &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(<span class="kw">seq_len</span>(<span class="kw">nrow</span>(others_haps)), function(hap_i) {
            <span class="kw"><a href="../reference/count_haplotype_occurrences_individuals.html">count_haplotype_occurrences_individuals</a></span>(<span class="dt">individuals =</span> live_individuals, 
                                                    <span class="dt">haplotype =</span> others_haps[hap_i, ])
          }))
<span class="kw">sum</span>(others_haps_counts)</code></pre></div>
<pre><code>## [1] 101</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(mixres$pids_others_included)</code></pre></div>
<pre><code>## [1] 101</code></pre>
<p>Compare with profiles of true contributors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rbind</span>(H1, H2)</code></pre></div>
<pre><code>##    [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
## H1    1    1    0    0    0    0   -1    0    0     1     0     0     0
## H2    0    1   -1    1    0    0    0    1    1     1     0     0     0
##    [,14] [,15] [,16] [,17] [,18] [,19] [,20]
## H1     0    -1     0    -1     0     0     0
## H2     0    -1     0    -1     0     0     0</code></pre>
</div>
</div>
<div id="other-functions" class="section level1">
<h1 class="hasAnchor">
<a href="#other-functions" class="anchor"></a>Other functions</h1>
<div id="variance-in-number-of-children" class="section level2">
<h2 class="hasAnchor">
<a href="#variance-in-number-of-children" class="anchor"></a>Variance in number of children</h2>
<p>Let <span class="math inline">\(\alpha\)</span> be the parameter of a symmetric Dirichlet distribution specifying each man’s probability to be the father of an arbitrary male in the next generation. When <span class="math inline">\(\alpha=5\)</span>, a man’s relative probability to be the father has 95% probability to lie between 0.32 and 2.05, compared with a constant 1 under the standard Wright-Fisher model and the standard deviation in the number of male offspring per man is 1.10 (standard Wright-Fisher = 1).</p>
<p>This symmetric Dirichlet distribution is implemented by drawing father (unscaled) probabilities from a Gamma distribution with parameters shape and scale that are then normalised to sum to 1. To obtain a symmetric Dirichlet distribution with parameter <span class="math inline">\(\alpha\)</span>, the shape must be <span class="math inline">\(\alpha\)</span> and scale <span class="math inline">\(1/\alpha\)</span>. This is simulated as follows (note the <code>enable_gamma_variance_extension</code> parameter):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dirichlet_alpha &lt;-<span class="st"> </span><span class="dv">5</span>

<span class="kw">set.seed</span>(<span class="dv">1</span>)
sim_res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sample_geneology.html">sample_geneology</a></span>(<span class="dt">population_size =</span> <span class="dv">10</span>, 
                            <span class="dt">generations =</span> <span class="dv">10</span>, 
                            <span class="dt">enable_gamma_variance_extension =</span> <span class="ot">TRUE</span>,
                            <span class="dt">gamma_parameter_shape =</span> dirichlet_alpha,
                            <span class="dt">gamma_parameter_scale =</span> <span class="dv">1</span> /<span class="st"> </span>dirichlet_alpha,
                            <span class="dt">progress =</span> <span class="ot">FALSE</span>)
pedigrees &lt;-<span class="st"> </span><span class="kw"><a href="../reference/build_pedigrees.html">build_pedigrees</a></span>(sim_res$population, <span class="dt">progress =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(pedigrees)</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-44-1.png" width="672"></p>
<p>Let us verify the claim that the standard deviation in the number of male offspring per man is 1.10. The easiest way is to get information about father id’s, which is done by asking for a <code>verbose_result</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">N &lt;-<span class="st"> </span><span class="dv">10000</span>

<span class="kw">set.seed</span>(<span class="dv">1</span>)
sim_res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sample_geneology.html">sample_geneology</a></span>(<span class="dt">population_size =</span> N, 
                            <span class="dt">generations =</span> <span class="dv">2</span>, 
                            <span class="dt">extra_generations_full =</span> <span class="dv">2</span>,
                            <span class="dt">enable_gamma_variance_extension =</span> <span class="ot">TRUE</span>,
                            <span class="dt">gamma_parameter_shape =</span> dirichlet_alpha,
                            <span class="dt">gamma_parameter_scale =</span> <span class="dv">1</span>/dirichlet_alpha,
                            <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose_result =</span> <span class="ot">TRUE</span>)

tbl_fathers_with_children &lt;-<span class="st"> </span><span class="kw">table</span>(sim_res$father_pids[, <span class="dv">1</span>])
tbl_fathers_no_children &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, N -<span class="st"> </span><span class="kw">length</span>(tbl_fathers_with_children))

number_of_children &lt;-<span class="st"> </span><span class="kw">c</span>(tbl_fathers_with_children, tbl_fathers_no_children)
number_of_children &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(number_of_children)

<span class="kw">mean</span>(number_of_children)</code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sd</span>(number_of_children)</code></pre></div>
<pre><code>## [1] 1.08854</code></pre>
<p>Let os get estimates in parallel:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">get_number_children &lt;-<span class="st"> </span>function(N) {
  sim_res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sample_geneology.html">sample_geneology</a></span>(<span class="dt">population_size =</span> N, 
                              <span class="dt">generations =</span> <span class="dv">2</span>, 
                              <span class="dt">extra_generations_full =</span> <span class="dv">2</span>,
                              <span class="dt">enable_gamma_variance_extension =</span> <span class="ot">TRUE</span>,
                              <span class="dt">gamma_parameter_shape =</span> dirichlet_alpha,
                              <span class="dt">gamma_parameter_scale =</span> <span class="dv">1</span> /<span class="st"> </span>dirichlet_alpha,
                              <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose_result =</span> <span class="ot">TRUE</span>)
  
  tbl_fathers_with_children &lt;-<span class="st"> </span><span class="kw">table</span>(sim_res$father_pids[, <span class="dv">1</span>])
  tbl_fathers_no_children &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, N -<span class="st"> </span><span class="kw">length</span>(tbl_fathers_with_children))
  
  number_of_children &lt;-<span class="st"> </span><span class="kw">c</span>(tbl_fathers_with_children, tbl_fathers_no_children)
  number_of_children &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(number_of_children)
  
  <span class="kw">return</span>(number_of_children)
}

<span class="kw">library</span>(parallel)
<span class="kw">options</span>(<span class="dt">mc.cores =</span> <span class="dv">2</span>)
<span class="kw">RNGkind</span>(<span class="st">"L'Ecuyer-CMRG"</span>) <span class="co"># for mclapply</span>
<span class="kw">set.seed</span>(<span class="dv">1</span>)
x &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/parallel/topics/mclapply">mclapply</a></span>(<span class="dv">1</span>:<span class="dv">100</span>, function(i) <span class="kw">get_number_children</span>(<span class="dv">100</span>))
sds &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(x, sd))
<span class="kw">mean</span>(sds)</code></pre></div>
<pre><code>## [1] 1.100545</code></pre>
</div>
<div id="population-growth" class="section level2">
<h2 class="hasAnchor">
<a href="#population-growth" class="anchor"></a>Population growth</h2>
<p>Population growth can be simulated by specifying the population size at each generation by the <code>population_sizes</code> vector, where the length thus specifies the number of generations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
sim_res_growth &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sample_geneology_varying_size.html">sample_geneology_varying_size</a></span>(<span class="dt">population_sizes =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">10</span>), <span class="dt">extra_generations_full =</span> <span class="dv">3</span>, <span class="dt">progress =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>Note how <code>extra_generations_full</code> was used to obtain all individuals in the generations (and not just those with descendants in the last two):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pedigrees_growth &lt;-<span class="st"> </span><span class="kw"><a href="../reference/build_pedigrees.html">build_pedigrees</a></span>(sim_res_growth$population, <span class="dt">progress =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(pedigrees_growth)</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-49-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#population-simulation">Population simulation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#building-the-pedigrees">Building the pedigrees</a></li>
      <li><a href="#run-a-mutation-process">Run a mutation process</a></li>
      <li><a href="#more-than-1-full-generation">More than 1 full generation</a></li>
      <li><a href="#simulate-to-one-founder">Simulate to one founder</a></li>
      </ul>
</li>
      <li>
<a href="#counting-matches">Counting matches</a><ul class="nav nav-pills nav-stacked">
<li><a href="#simulating-the-population">Simulating the population</a></li>
      <li><a href="#drawing-an-individual-and-counting-matches">Drawing an individual and counting matches</a></li>
      <li><a href="#mixtures">Mixtures</a></li>
      </ul>
</li>
      <li>
<a href="#other-functions">Other functions</a><ul class="nav nav-pills nav-stacked">
<li><a href="#variance-in-number-of-children">Variance in number of children</a></li>
      <li><a href="#population-growth">Population growth</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Mikkel Meyer Andersen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
